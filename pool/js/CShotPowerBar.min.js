function CShotPowerBar(e, t, i, s = s_oStage) {
  var n, r, o, a, h, c, _, d, u, g, p, y, w, E, S, v, O;
  (this._init = function (e, t, i, s) {
    (y = !0),
      (n = e),
      ((r = new createjs.Container()).x = t),
      (r.y = i),
      n.addChild(r),
      (O = !1);
    var P = s_oSpriteLibrary.getSprite("over_shot_bar");
    (o = new createjs.Container()), r.addChild(o);
    var R = s_oSpriteLibrary.getSprite("shot_bar");
    ((a = createBitmap(R)).y = 15 - P.height),
      o.addChild(a),
      (o.y = p = 15),
      (g = P.height - 60);
    var f = s_oSpriteLibrary.getSprite("stick");
    ((h = createBitmap(f)).x = R.width / 2),
      (h.regX = f.width),
      (h.regY = f.height / 2),
      (h.rotation -= 90),
      o.addChild(h);
    var l = createBitmap(P);
    (l.x = -15), (l.y = -15), r.addChild(l);
    var x = new createjs.Shape();
    x.graphics
      .beginFill("black")
      .drawRoundRect(0, 0, P.width - 30, P.height - 30, 16),
      (o.mask = x),
      (d = { x: 0, y: 0 }),
      (c = { x: t, y: i }),
      (_ = { x: -P.width, y: i }),
      (u = new createjs.Shape()).graphics
        .beginFill("black")
        .drawRect(0, 0, R.width, R.height),
      (u.x = r.x),
      (u.y = r.y),
      (u.alpha = 0.01),
      s.addChild(u),
      (w = new Array()),
      (E = new Array()),
      (S = new Array()),
      (v = {});
  }),
    (this._onPressMouseDown = function (e) {
      y &&
        (createjs.Tween.removeTweens(o),
        (d = { x: e.stageX, y: e.stageY }),
        this.triggerEvent(ON_MOUSE_DOWN_POWER_BAR),
        (v.pressmove = u.on("pressmove", this._onPressMove, this)),
        (v.pressup = u.on("pressup", this._onPressUp, this)));
    }),
    (this._onPressMove = function (e) {
      if (y) {
        var t = e.stageY - d.y;
        t < p ? (t = p) : t > g && (t = g),
          (o.y = t),
          (S[ON_PRESS_MOVE_POWER_BAR] = this._normalizePowerShot(t)),
          this.triggerEvent(ON_PRESS_MOVE_POWER_BAR);
      }
    }),
    (this._normalizePowerShot = function (e) {
      return linearFunction(e, p, g, 0, MAX_POWER_SHOT);
    }),
    (this._onPressUp = function () {
      y &&
        (this.triggerEvent(ON_PRESS_UP_POWER_BAR),
        u.off("pressmove", v.pressmove),
        u.off("pressup", v.pressup));
    }),
    (this._reset = function (e = 300) {
      createjs.Tween.get(o, { override: !0 }).to(
        { y: p },
        e,
        createjs.Ease.cubicIn
      );
    }),
    (this.show = function (e = 500) {
      this._reset(0),
        (O = !0),
        createjs.Tween.get(r, { override: !0 })
          .to({ x: c.x, y: c.y }, e, createjs.Ease.cubicOut)
          .call(
            function () {
              this.setInput(!0);
            },
            null,
            this
          )
          .on("change", function () {
            (u.x = r.x), (u.y = r.y);
          });
    }),
    (this.hide = function (e = 500) {
      O &&
        ((O = !1),
        this.setInput(!1),
        createjs.Tween.get(r, { override: !0 })
          .to({ x: _.x, y: _.y }, e, createjs.Ease.cubicIn)
          .on("change", function () {
            (u.x = r.x), (u.y = r.y);
          }));
    }),
    (this.setInput = function (e) {
      y = e;
    }),
    (this.setStickY = function (e) {
      o.y = e;
    }),
    (this.triggerEvent = function (e) {
      w[e] && w[e].call(E[e], S[e]);
    }),
    (this.addEventListener = function (e, t, i, s) {
      (w[e] = t), (E[e] = i), (S[e] = s);
    }),
    (this.addInitEventListener = function () {
      v.mousedown = u.on("mousedown", this._onPressMouseDown, this);
    }),
    this._init(e, t, i, s);
}
var ON_MOUSE_DOWN_POWER_BAR = 0,
  ON_PRESS_MOVE_POWER_BAR = 1,
  ON_PRESS_UP_POWER_BAR = 2;
